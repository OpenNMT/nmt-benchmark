function setEventListeners(){$(".getSource").on("click",function(){var t=$(this).attr("data-fileId");window.open("/download/test/"+t)}),$(".deleteOutput").on("click",function(){var t={url:"/testOutput/delete/"+$(this).attr("data-testOutputId"),done:function(){location.reload()},header:"Are you sure you want to delete this translation?",content:"All associated scores will be lost",$target:$(this)};confirm(t)}),$(".uploadOutput").on("click",function(){$(this).removeClass("icon"),$(this).addClass("loading"),$(this).closest("form").submit()}),$(".deleteOutput, .getSource, .selectOutput, .uploadOutput").on("keypress",function(t){13!==t.which&&32!==t.which||(t.preventDefault(),$(t.target).trigger("click"))})}function getDescription(){var t={};return $(".ui.form input, .ui.form textarea, .ui.form select").each(function(e,n){"constraint"===$(n).attr("name")?t[$(n).attr("name")]=$(n).is(":checked"):t[$(n).attr("name")]=$(n).val()}),t}function confirm(t){$(".ui.modal").modal({blurring:!0,onApprove:function(){$.get(t.url).done(function(e){try{e=JSON.parse(e)}catch(t){console.log("Unable to parse server response, should be a JSON object already")}if(e.error){var n="error";if(e.error.errors){var i="";for(var r in e.error.errors)e.error.errors.hasOwnProperty(r)&&(i+=e.error.errors[r].message);flash(n,i)}else flash(n,e.error)}else t.done()}).fail(function(t){var e="error";flash(e,t),console.log(t.trace)})},onShow:function(){$("#dialogHeader").text(t.header),$("#dialogDescription").text(t.content)},onVisible:function(){$(".ui.modal").find(".cancel.button").focus()},onHidden:function(){$(t.$target).focus()}}).modal("show")}function wrapSetDropdownContent(){setDropdownContent({$target:$("select[name=sourceLanguage]"),column:"src"}),setDropdownContent({$target:$("select[name=targetLanguage]"),column:"tgt"})}function setDropdownContent(t){$.get("/getLanguagePairs").done(function(e){var n={},i=e.data.map(function(e){return e[t.column]}).filter(function(t){if(!n.hasOwnProperty(t))return n[t]=1,!0}).sort(function(t,e){return c2l[t]<c2l[e]?-1:1}).map(function(t){var e=[];return e.push('<option value="'+t+'">'+c2l[t]+"</option>"),e.join("")});t.$target.html(i)}).fail(function(t){flash("error",t),console.log(t)})}function getTestSets(){return new Promise(function(t,e){$.get("/getTestSets?src="+src+"&tgt="+tgt).done(function(e){t(e.data)}).fail(function(t){e(t)})})}function getTranslationOutputs(t){return new Promise(function(e,n){$.get("/getTranslationOutputs?systemId="+t).done(function(t){e(t.data)}).fail(function(t){n(t)})})}function showTestSetCards(){if(isAuthor){var t;getTestSets().then(function(e){return t=e,getTranslationOutputs(systemId)}).then(function(e){var n=t.map(function(t){var n=e.filter(function(e){return t._id===e.fileId})[0];return testSetTemplate(t,n)}).join("");$(".last.row .ui.cards").html(n),customizeFileOutput(),setEventListeners()}).catch(function(t){console.log(t),flash("error",t)})}}function testSetTemplate(t,e){var n=[];return n.push('<div class="ui raised fluid card" style="width: 450px;">'),n.push('<div class="content">'),n.push('<div class="header" style="display: flex; justify-content: space-between; align-items: center">'),n.push(t.source.fileName),n.push("</div>"),n.push('<div class="description">'),n.push("<ul>"),n.push("<li>Domain: "+t.domain+"</li>"),n.push("<li>Origin: "+t.origin+"</li>"),e&&(n.push("<li>File: "+t.fileName),isAuthor&&n.push('<i class="trash icon fireBrick deleteOutput" data-testOutputId="'+e._id+'" role="button" tabindex="0" aria-label="Delete translation output"></i>'),n.push("</li>"),n.push("<li>Date: "+new Date(e.date).toLocaleDateString()+"</li>"),e.scores&&n.push("<li>Score: "+e.scores.BLEU+"</li>")),n.push("</ul>"),n.push('<div class="getSource ui basic fireBrick button" data-fileId="'+t._id+'" role="button" tabindex="0" aria-label="Download source file">'),n.push('<i class="download icon"></i>'),n.push("Get source"),n.push("</div>"),n.push("</div>"),n.push("</div>"),!e&&isAuthor&&(n.push('<div class="extra content">'),n.push('<div class="header" style="margin-bottom: 10px; margin-top: 5px;">'),n.push("Translation"),n.push("</div>"),n.push('<form action="/testOutput/upload" enctype="multipart/form-data" method="post">'),n.push('<div class="selectOutput ui icon input" data-fileId="'+t._id+'">'),n.push('<input class="fileName" />'),n.push('<i class="folder open icon"></i>'),n.push("</div>"),n.push('<div class="uploadOutput ui icon disabled button" data-fileId="'+t._id+'" role="button" tabindex="0" aria-label="Upload translation output">'),n.push('<i class="upload icon"></i>'),n.push("Upload"),n.push("</div>"),n.push('<input type="file" name="file" style="display: none;" data-fileId="'+t._id+'" />'),n.push('<input type="hidden" name="fileId" value="'+t._id+'" />'),n.push('<input type="hidden" name="systemId" value="'+systemId+'" />'),n.push("</form>"),n.push("</div>")),n.push("</div>"),n.join("")}function customizeFileOutput(){$(document).on("change",":file[name=file]",function(){var t=$(this),e=t.val().replace(/\\/g,"/").replace(/.*\//,""),n=$(this).closest("form");t.trigger("fileselect",[e,n])}),$(":file[name=file]").on("fileselect",function(t,e,n){var i=n.find(".selectOutput"),r=n.find(".uploadOutput");i.find("input").val(e),e?(r.removeClass("disabled"),r.addClass("basic fireBrick")):(r.removeClass("basic fireBrick"),r.addClass("disabled"))}),$(".selectOutput").on("click",function(){var t=$(this).attr("data-fileId");$(':file[data-fileId="'+t+'"]').trigger("click")}),$(".fileName").on("focus",function(){$(this).blur()})}$(document).ready(function(){"view"===mode?($(".ui.form .input").addClass("transparent"),showTestSetCards(),$("#systemId").popup()):(wrapSetDropdownContent(),$("label").popup({hoverable:!0})),click2copy("systemId"),$(".ui.dropdown").dropdown(),$(".ui.toggle.checkbox").checkbox({onChange:function(){var t=$(this).prop("checked")?"Yes":"No";$(this).next("label").text(t),$(".trainSet").transition({animation:"slide down",duration:"0.5s"}),"No"===t?$(".trainSet").addClass("required"):$(".trainSet").removeClass("required")}}),$("#translationSystem .field.required, input[name=trainSet], input[name=constraint]").on("input change",function(t){var e=$("#translationSystem .field.required").map(function(t,e){return $(e).find("input").attr("name")?!!$(this).find("input").val().trim():!!$(this).find("select").val().length}).toArray().reduce(function(t,e){return t&&e},!0),n=$("input[name=constraint]").prop("checked")||$("input[name=trainSet]").val().trim(),i=$("input[name=systemName]").val().trim().match(/^[^:]+:[^:]/);e&&i&&n?($("#createSystem").removeClass("disabled"),$("#createSystem").addClass("basic fireBrick")):($("#createSystem").addClass("disabled"),$("#createSystem").removeClass("basic fireBrick"))}),$("#createSystem").on("click",function(){var t=getDescription(),e=t.system_id?"/translationSystem/update":"/translationSystem/create";$.post(e,t).done(function(t){try{t=JSON.parse(t)}catch(t){console.log("Unable to parse server response, should be a JSON object already")}if(t.error){var e="error";if(t.error.errors){var n="";for(var i in t.error.errors)t.error.errors.hasOwnProperty(i)&&(n+=t.error.errors[i].message);flash(e,n)}else flash(e,t.error)}else window.location="/translationSystem/view/"+t.data._id}).fail(function(t){flash("error",t),console.log(t,t.stack)})}),"view"===mode&&$("#deleteSystem").on("click",function(){var t={url:"/translationSystem/delete/"+translationSystem._id,done:function(){window.location="/"},header:"Are you sure you want to delete this system?",content:"All associated translations and scores will be lost",$target:$(this)};confirm(t)}),$("#createSystem, #deleteSystem").on("keypress",function(t){13!==t.which&&32!==t.which||(t.preventDefault(),$(t.target).trigger("click"))}),$(".cancel.button, .ok.button").on("keypress",function(t){13!==t.which&&32!==t.which||(t.preventDefault(),$(t.target).trigger("click"))})});