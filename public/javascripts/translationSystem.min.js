function setEventListeners(){$(".getSource").on("click",function(){console.log("get source");var e=$(this).attr("data-fileId");window.open("/download/test/"+e)}),$(".deleteOutput").on("click",function(){console.log("delete");var e={url:"/testOutput/delete/"+$(this).attr("data-testOutputId"),done:function(){location.reload()},header:"Are you sure you want to delete this translation?",content:"All associated scores will be lost",$target:$(this)};confirm(e)}),$(".uploadOutput").on("click",function(){console.log("upload"),$(this).closest("form").submit()}),$(".deleteOutput, .getSource, .selectOutput, .uploadOutput").on("keypress",function(e){13!==e.which&&32!==e.which||(e.preventDefault(),$(e.target).trigger("click"))})}function getDescription(){var e={};return $(".ui.form input, .ui.form textarea").each(function(t,n){e[$(n).attr("name")]=$(n).val()}),e}function setDescription(e){$(".ui.form input, .ui.form textarea").each(function(t,n){var i=$(n).attr("name");$(n).val(e[i]||""),$(n).attr("placeholder",""),$(n).attr("disabled",!0)})}function confirm(e){$(".ui.modal").modal({blurring:!0,onApprove:function(){$.get(e.url).done(function(t){try{t=JSON.parse(t)}catch(e){console.log("Unable to parse server response, should be a JSON object already")}if(t.error){var n="error";if(t.error.errors){var i="";for(var o in t.error.errors)t.error.errors.hasOwnProperty(o)&&(i+=t.error.errors[o].message);flash(n,i)}else flash(n,t.error)}else e.done()}).fail(function(e){var t="error";flash(t,e),console.log(e.trace)})},onShow:function(){$("#dialogHeader").text(e.header),$("#dialogDescription").text(e.content)},onVisible:function(){$(".ui.modal").find(".cancel.button").focus()},onHidden:function(){$(e.$target).focus()}}).modal("show")}function wrapSetDropdownContent(){setDropdownContent({target:$("input[name=sourceLanguage]").closest(".dropdown").find(".menu"),column:"src"}),setDropdownContent({target:$("input[name=targetLanguage]").closest(".dropdown").find(".menu"),column:"tgt"})}function setDropdownContent(e){$.get("/getLanguagePairs").done(function(t){var n=t.data.map(function(t){var n=[];return n.push('<div class="item active">'+c2l[t[e.column]]+"</div>"),n.join("")});e.target.html(n)}).fail(function(e){flash("error",e),console.log(e)})}function getTestSets(){return new Promise(function(e,t){$.get("/getTestSets?src="+src+"&tgt="+tgt).done(function(t){e(t.data)}).fail(function(e){t(e)})})}function getTranslationOutputs(e){return new Promise(function(t,n){$.get("/getTranslationOutputs?systemId="+e).done(function(e){t(e.data)}).fail(function(e){n(e)})})}function showTestSetCards(){var e;getTestSets().then(function(t){return e=t,getTranslationOutputs(systemId)}).then(function(t){var n=e.map(function(e){var n=t.filter(function(t){return e._id===t.fileId})[0];return testSetTemplate(e,n)}).join("");$(".last.row .ui.cards").html(n),customizeFileOutput(),setEventListeners()}).catch(function(e){console.log(e),flash("error",e)})}function testSetTemplate(e,t){var n=[];return n.push('<div class="ui raised centered fluid card" style="width: 450px;">'),n.push('<div class="content">'),n.push('<div class="header" style="display: flex; justify-content: space-between; align-items: center">'),n.push(e.source.fileName),n.push("</div>"),n.push('<div class="description">'),n.push("<ul>"),n.push("<li>Domain: "+e.domain+"</li>"),n.push("<li>Origin: "+e.origin+"</li>"),t&&(n.push("<li>File: "+e.fileName),isAuthor&&n.push('<i class="trash icon fireBrick deleteOutput" data-testOutputId="'+t._id+'" role="button" tabindex="0" aria-label="Delete translation output"></i>'),n.push("</li>"),n.push("<li>Date: "+new Date(t.date).toLocaleDateString()+"</li>"),t.scores&&n.push("<li>Score: "+t.scores.BLEU+"</li>")),n.push("</ul>"),n.push('<div class="getSource ui basic fireBrick button" data-fileId="'+e._id+'" role="button" tabindex="0" aria-label="Download source file">'),n.push('<i class="download icon"></i>'),n.push("Get source"),n.push("</div>"),n.push("</div>"),n.push("</div>"),!t&&isAuthor&&(n.push('<div class="extra content">'),n.push('<div class="header" style="margin-bottom: 10px; margin-top: 5px;">'),n.push("Translation"),n.push("</div>"),n.push('<form action="/testOutput/upload" enctype="multipart/form-data" method="post">'),n.push('<div class="selectOutput ui icon input" data-fileId="'+e._id+'">'),n.push('<input class="fileName" />'),n.push('<i class="folder open icon"></i>'),n.push("</div>"),n.push('<div class="uploadOutput ui icon disabled button" data-fileId="'+e._id+'" role="button" tabindex="0" aria-label="Upload translation output">'),n.push('<i class="upload icon"></i>'),n.push("Upload"),n.push("</div>"),n.push('<input type="file" name="file" style="display: none;" data-fileId="'+e._id+'" />'),n.push('<input type="hidden" name="fileId" value="'+e._id+'" />'),n.push('<input type="hidden" name="systemId" value="'+systemId+'" />'),n.push("</form>"),n.push("</div>")),n.push("</div>"),n.join("")}function customizeFileOutput(){$(document).on("change",":file[name=file]",function(){var e=$(this),t=e.val().replace(/\\/g,"/").replace(/.*\//,""),n=$(this).closest("form");e.trigger("fileselect",[t,n])}),$(":file[name=file]").on("fileselect",function(e,t,n){var i=n.find(".selectOutput"),o=n.find(".uploadOutput");i.find("input").val(t),t?(o.removeClass("disabled"),o.addClass("basic fireBrick")):(o.removeClass("basic fireBrick"),o.addClass("disabled"))}),$(".selectOutput").on("click",function(){var e=$(this).attr("data-fileId");$(':file[data-fileId="'+e+'"]').trigger("click")}),$(".fileName").on("focus",function(){$(this).blur()})}$(document).ready(function(){"view"===mode?($(".ui.form .input").addClass("transparent"),setDescription(translationSystem),showTestSetCards()):wrapSetDropdownContent(),$("label").popup(),$(".ui.dropdown").dropdown(),$(".ui.toggle.checkbox").checkbox({onChange:function(){var e=$(this).prop("checked")?"On":"Off";$(this).next("label").text(e),$(".trainSet").transition({animation:"slide down",duration:"0.5s"})}}),$("#translationSystem .field.required").on("input",function(e){var t=$("#translationSystem .field.required").map(function(){return!!$(this).find("input").val().trim()}).toArray().reduce(function(e,t){return e&&t},!0),n=$("input[name=systemName]").val().trim().match(/^[^:]+:[^:]/);t&&n?($("#createSystem").removeClass("disabled"),$("#createSystem").addClass("basic fireBrick")):($("#createSystem").addClass("disabled"),$("#createSystem").removeClass("basic fireBrick"))}),$("#createSystem").on("click",function(){var e=getDescription(),t=e.system_id?"/translationSystem/update":"/translationSystem/create";$.post(t,e).done(function(e){try{e=JSON.parse(e)}catch(e){console.log("Unable to parse server response, should be a JSON object already")}if(e.error){var t="error";if(e.error.errors){var n="";for(var i in e.error.errors)e.error.errors.hasOwnProperty(i)&&(n+=e.error.errors[i].message);flash(t,n)}else flash(t,e.error)}else window.location="/translationSystem/view/"+e.data._id}).fail(function(e){flash("error",e),console.log(e,e.stack)})}),"view"===mode&&$("#deleteSystem").on("click",function(){var e={url:"/translationSystem/delete/"+translationSystem._id,done:function(){window.location="/"},header:"Are you sure you want to delete this system?",content:"All associated translations and scores will be lost",$target:$(this)};confirm(e)}),$("#createSystem, #deleteSystem").on("keypress",function(e){13!==e.which&&32!==e.which||(e.preventDefault(),$(e.target).trigger("click"))}),$(".cancel.button, .ok.button").on("keypress",function(e){13!==e.which&&32!==e.which||(e.preventDefault(),$(e.target).trigger("click"))})});